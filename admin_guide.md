# Конкурсное задание компетенции "Сетевое и системное администрирование" чемпионата ReaSkills 2026

**Версия 6 от 12.01.2026**

----
## Это полезно знать

Во-первых, прочитайте задание полностью. Обратите внимание на то, что задание написано не в хронологическом порядке, последовательность действий для выполнения задания остается на ваше усмотрение. Выполнение задания на 100% за отведенное время теоретически возможно, но от вас не требуется выполнять задание полностью. Распределите время работы таким образом, чтобы заработать максимальное количество баллов. 

Во время выполнения задания руководствуйтесь следующими полезными советами:
* Если вам необходимо установить пароль, но в задании не указано, какой именно – установите **P@ssw0rd**.
* Если вы по каким-либо причинам хотите использовать свои собственные учетные данные/адреса/dns имена – не забудьте указать их в черновике и оставить его на вашем рабочем месте.
* Внимательно проверяйте свою работу. Если эксперты не смогут подключится к чему-либо по какой-либо причине (сетевая недоступность, не подходят учетные данные) – проверка этого устройства производится не будет.
* Перед сдачей работы проверьте, что все устройства и сервисы "переживают" перезагрузку.
* Любые дополнительные комментарии и пожелания на проверку вы можете оставить для экспертов в черновике. Ваши комментарии гарантированно будут прочитаны перед проверкой или во время проверки.
* Если вы столкнулись с непониманием пункта задания – поднимите руку и спросите.
* Вы можете расходовать ваше время так, как вам этого хочется. Помните, что время, затраченное на ваши нужды, не компенсируется, за исключением обеда и случаев проблем со стороны площадки.
* Если не указано иное, доступ к любому URL ожидается по стандартным портам.
* Сервер с нужными файлами доступен по адресу http://10.150.0.200/ (далее - files).
* Сервер DNS, обслуживающий зону tech.skills, доступен по адресу 10.113.38.139.
* Доступ к необходимым ресурсам (репозитории и т.п.) предоставляется через прокси-сервер. Для настройки прокси сервера используйте следующие команды:
```
# на уровне оболочки
export http_proxy="http://proxy.tech.skills:3128"
export https_proxy="http://proxy.tech.skills:3128"
```
```
# на уровне пакетного менеджера apt. 
# Для этого создайте файл /etc/apt/apt.conf.d/90-proxy.conf и укажите в нём:

Acquire::http::Proxy "http://proxy.tech.skills:3128";
Acquire::https::Proxy "http://proxy.tech.skills:3128";
```
```
# на уровне пакетного менеджера pip
# Для этого создайте файл ~/.config/pip/pip.conf и укажите в нём:
[global]
proxy = http://proxy.tech.skills:3128
```
* В сети доступен реестр образов Docker - http://registry.tech.skills:5000. Для того чтобы использовать его, вам необходимо создать файл `/etc/docker/daemon.json` с содержимым:
```json
{
  "insecure-registries": ["registry.tech.skills:5000"]
}
```
Посмотреть доступные образы в Registry можно либо через браузер, либо через утилиту CURL по URL http://registry.tech.skills:5000/v2/_catalog

* Время на выполнение задания - **12 часов**.

#### Как будет происходить оценка?

Каждый субкритерий имеет приблизительно одинаковый вес. Пункты внутри каждого критерия имеют разный вес, в зависимости от сложности пункта и количества пунктов в субкритерии.
Схема оценка построена таким образом, чтобы каждый пункт оценивался только один раз. Например, в секции «Базовая конфигурация» предписывается настроить имена для всех устройств, однако этот пункт будет проверен на трех случайных устройствах, одинаковых для каждого участника и определяемых группой проверки и оценен только 1 раз. Одинаковые пункты могут быть проверены и оценены больше, чем 1 раз, если для их выполнения применяются разные настройки или они выполняются на разных классах устройств. 
Подробное описание методики проверки должно быть разработано экспертами, принимавшими участие в оценке конкурсного задания чемпионата, и вынесено в отдельный документ. Данный документ, как и схема оценки, является объектом внесения 30% изменений.

#### Базовые требования

Сконфигурируйте базовые параметры виртуальных машин для обеспечения идентификации и сетевой связанности. Обязательно должно быть настроено полное доменное имя и IP адрес согласно топологии. Окружение виртуальных машин, такое как оболочки, текстовые редакторы, графический интерфейс и прочее не является обязательным и остается на усмотрение участника. 
Виртуальные машины должны иметь возможность связываться друг с другом по доменным именам. Перед сдачей работы на проверку убедитесь, что с каждой виртуальной машины возможен доступ по доменному имени к любому сервису предприятия или к любой другой виртуальной машине.
На каждую виртуальную машину обеспечьте доступ по протоколу SSH с использованием парольной аутентификации для обычного пользователя, созданного по умолчанию. Доступ до виртуальных машин с использованием пользователя root должен быть запрещен. Если вам необходимо разрешить доступ под пользователем root – запретите парольный доступ и используйте сгенерированную вами пару ключей. Ключи следует расположить в стандартной директории. 
Обеспечьте наличие на каждой клиентской машине утилит **curl**, **wget** и **host**.


#### Желаем успехов!

-----------


## Модуль А: «Пуско-наладка инфраструктуры на основе OC семейства Linux»

#### Настройка службы каталога

1. На **CR-DC** разверните службу каталога на базе ALD Pro 3.X.X. 
    * Пользователей необходимо импортировать с доменного контроллера на хосте **WIN-AD**. После переноса пользователей выключите его. 
    * Все машины с префиксом **-CLI** в названии должны иметь возможность аутентификации через ALD Pro. 
    * В качестве имени домена используйте **rea26.skills**. Обеспечьте доступ к WEB интерфейсу ALD Pro по имени **ald.rea26.skills**. 
    * В качестве административной учетной записи используйте **admin** с паролем **P@ssw0rd**.
    * Обеспечьте наличие резервного доменного контроллера в офисе Branch, используйте для этого хост **BR-DC**.

2. Сконфигурируйте права пользователей.
    * На **BR-CLI** могут аутентифицироваться только пользователи группы branch и локальные пользователи.
    * Пользователи группы main имеют право аутентифицироваться на любом клиентском ПК.
    * На **OUT-CLI** имеют право аутентифицироваться только пользователи группы **remotes** и локальные пользователи
    * Пользователи группы **main** должны иметь возможность повышать привилегии с использованием sudo. У других доменных пользователей такой возможности быть не должно.
    * Пользователи группы **branch** должны иметь возможность повышать привилегии для выполнения ограниченного набора команд: `cat`, `grep` и `id`.
    * Все пользователи, которым разрешен доступ к sudo должны иметь возможность выполнения команд с повышенными привилегиями без ввода пароля.

3. Реализуйте общие каталоги. 
    * Каталог **Important**: доступ для чтения и записи имеет только группа branch. Остальные пользователи имеют доступ в формате read only. Каталог должен быть смонтирован на рабочий стол всех доменных пользователей.
    * Каталог **Exchanger**: все пользователи имеют права для чтения и записи в данный каталог. При этом, удалять файлы из этого каталога могут только владельцы файлов. Каталог должен быть смонтирован на рабочий стол всех доменных пользователей.
    * Локальные учетные записи не должны получать общие каталоги доменных пользователей.

4. На всех клиентских компьютерах домена и для всех пользователей должна быть установлена картинка **desktop.jpeg**. Найти картинку можно на files.

#### Настройка базовых сервисов

1. Реализуйте центр сертификации предприятия на сервере **CR-SRV** (Сделано не до конца). 
    * Используйте **/etc/ca** в качестве корневого каталога для центра сертификации. 
        * sudo apt-get install openssl
        * sudo mkdir -p /etc/ca/{certs,crl,newcerts,private}
        * sudo chmod 700 /etc/ca/private
        * sudo touch /etc/ca/index.txt
        * sudo sh -c "echo 1000 > /etc/ca/serial"
        * sudo cp /etc/ssl/openssl.cnf /etc/ca/
        * в /etc/ca/openssl.cnf в секции CA_default должно быть dir = /etc/ca
        * cd /etc/ca
        * sudo openssl genpkey -algorithm RSA -pkeyopt rsa_keygen_bits:4096 -out private/ca.key.pem - генерация привиатного ключа для CA
        * sudo chmod 400 private/ca.key.pem
        * sudo openssl req -config openssl.cnf -key private/ca.key.pem -new -x509 -days 3650 -sha256 -extensions v3_ca -out certs/ca.cert.pem - создаем самыоподписанный серт СА
    * В качестве CN укажите **REA2026-CA**.
        * При создании самоподписанного серта СА указать при запросе Common Name REA2026-CA
    * Все устройства должны доверять данному центру сертификации на уровне системы, для работы утилит `curl` и `wget`. На клиентских ПК дополнительно необходимо обеспечить доверие к сертификату браузера firefox и почтового клиент thunderbird, для всех пользователей. 
        * Для доверия на системной уровне (curl wget) (на всех устройствах, хз насчет out устройств):
            * sudo cp /etc/ca/certs/ca.cert.pem /usr/local/share/ca-certificates/REA2026-CA.crt (для cr-srv, на другие надо перекинуть серт через scp) 
                * scp /etc/ca/certs/ca.cert.pem administrator@<ip>:~/REA2026-CA.crt
                * на хосте сделать sudo cp ~/REA2026-CA.crt /usr/local/share/ca-certificates/REA2026-CA.crt
            * sudo update-ca-certificates
        * Доверие в браузере и почте: firefox -> Настройки -> Сертификаты (в поиске) -> Просмотр сертификатов(Управление сертификатами) -> импортировать и выбираем заренее уже перекинутый на тачку ca.cert.pem
        * И так для каждого пользака надо сделать, но можно автоматизировать(не проверял)
            * sudo apt install libnss3-tools
            * 
            ```
            for profile in /home/*/.mozilla/firefox/*.default*; do
                certutil -A -n "REA2026-CA" -t "CT,," -d sql:"$profile" -i /usr/local/share/ca-certificates/REA2026-CA.crt
            done

            for profile in /home/*/.thunderbird/*.default*; do
                certutil -A -n "REA2026-CA" -t "CT,," -d sql:"$profile" -i /usr/local/share/ca-certificates/REA2026-CA.crt
            done
            ```
            * Или на каждом хосте в /usr/local/share/ca-certificates/mozila/REA2026-CA.crt и /usr/local/share/ca-certificates/thunderbird/REA2026-CA.crt  закинуть (надо проверить, но вроде Никита проверял и работало)
    * Все сервисы, предусматривающие доступ через web браузер, должны быть защищены с использованием сертификатов от данного центра сертификации (исключением является ALD Pro, веб интерфейс ALD Pro защищать сертификатом не обязательно).
        * Тут для сервисов надо выпускать сертификаты, которые должны быть подписаны нашим СА.
        * openssl genpkey -algorithm RSA -out myservice.key.pem -pkeyopt rsa_keygen_bits:2048 - генерим ключ на клиенте, где сервис, которым будем подписывать запрос на серт 
        * openssl req -new -key myservice.key.pem -out myservice.csr.pem  - делаем запрос на серт CN - fqdn по которому должен быть доступен сервис
        * Теперь сгенерированный запрос-файл (myservice.csr.pem) надо оправить на тачку с CA (CR-SRV) например через scp
        * В ca выпустить серт для сервиса по его запросу sudo openssl ca -config /etc/ca/openssl.cnf -in myservice.csr.pem -out myservice.crt.pem -extensions server_cert
        * Теперь надо оправить сгенерированный серт обратно на тачку с сервисом и в настрйоках сервиса (в конфиграции) указывать этот серт и ключ, который уже есть на тачке.
        * Теперь допустим наш сервис - это nginx(т е веб сайт), то когда клиент откроет в бразуере наш сайт через https, ему придет этот серт на тачку, он такой о серт, а кто его подписал, смотрит в свои серты и обнарживат там серт центра ca(ca.cert.pem) и такой, ну я вижу, что серт сервиса подписан вот этим, а я ему доверяю и установится SSL соединение и сможем открыть ~порнуху~ котика
2. На **CR-SRV** реализуйте почтовый сервер (Сделано не до конца). 
    * Почтовый сервер должен обеспечивать возможность пересылки почты в домене **rea26.skills** и поддерживать аутентификацию при помощи доменных учетных записей. 
        * sudo apt update
        * sudo apt install postfix dovecot-imapd dovecot-ldap dovecot-lmtpd libsasl2-modules sasl2-bin ca-certificates mailutils
        * /etc/postfix/main.cf
        * /etc/dovecot/dovecot.conf 
        * /etc/dovecot/dovecot-ldap.conf.ext
        * рестартим все (не дописано)
    * Подключение к почтовому серверу должно быть защищено с использованием сертификатов CA предприятия. 
    * При регистрации пользователя в почтовом клиенте не должно запрашиваться никаких дополнительных параметров, кроме имени пользователя и пароля. 
    * Для проверки отправьте письмо с компьютера **CR-CLI**, от пользователя **Lori** пользователю **Eva** на компьютере **BR-CLI**.

3. На сервере **CR-SRV** реализуйте централизованный сбор журналов (Сделано полностью). 
    * Журналы необходимо собирать с устройств **CR-RTR** и **BR-RTR** и помещать их в директорию **/opt/logs/\<hostname\>.log**
        * sudo apt install rsyslog
        * sudo mkdir -p /opt/logs
        * 
        ```
        В конец /etc/rsyslog.conf
        $template PerHostLogs,"/opt/logs/%HOSTNAME%.log"
        *.* ?PerHostLogs
        & ~

        Расскоментить две строки под provides UDP syslog recetion
        ```
        * sudo systemctl restart rsyslog
        * (config) rsyslog host 192.168.2.100 (на обоих роутерах)

    * Реализуйте ротацию логов: при достижении объёма в 10МБ журнал следует сжимать файл журнала. Выполнять ротацию следует раз в минуту.
        * В  /etc/logrotate.d/central-logs 
        ```
        /opt/logs/*.log {
            size 10M
            rotate 5
            compress
            missingok
            notifempty
            copytruncate
        }
        ```
        * Из-под рута crontab -e и написать  * * * * * /usr/sbin/logrotate /etc/logrotate.d/central-logs
        * sudo systemctl restart rsyslog
        * Проверить, что логи появлисть так ls -lh /opt/logs
        * Проверить ротируется ли, когда объем больше 10МБs
4. На **CR-SRV** разверните TFTP-сервер для создания резервных копий конфигураций маршрутизаторов (Сделано полностью). 
    * В качестве каталога используйте **/opt/configs**. 
        * sudo apt update
        * sudo apt install tftpd-hpa
        * sudo mkdir -p /opt/configs
        * sudo chown tftp:tftp /opt/configs
        * sudo chmod 777 /opt/configs
        * в /etc/default/tftpd-hpa
        ```
            TFTP_USERNAME="tftp"
            TFTP_DIRECTORY="/opt/configs"
            TFTP_ADDRESS="0.0.0.0:69"
            TFTP_OPTIONS="--secure --create"
        ```
        * sudo systemctl enable --now tftpd-hpa
        * Проверка работы: apt install tftp на клинете допустим cr-cli
        * tftp 192.168.2.100  -> put - загрузить на сервер, get - получить с сервера файл, verbose - расширенный вывод
    * Обеспечьте возможность резервного копирования конфигураций всех маршрутизаторов на сервер **CR-SRV**. Убедитесь, что на момент проверки присутствует хотя-бы одна резервная копия конфигурации. 
        * Скопировать стартап конфиг можно так: # copy startup-config tftp tftp://192.168.2.100/

5. Напишите скрипт вызова утилиты **snmpwalk** на **CR-SRV**
    * Скрипт должен быть доступен по имени `get_info` без явного указания пути и расширения, из любого места в системе.
        * sudo apt install snmpd 
        * Кладем в /usr/local/bin/ файл git/common/scripts/get_info
        * sudo chmod +x /usr/local/bin/get_info
        * В /etc/snmp/snmpd.conf agentaddress 0.0.0.0 поставить, вместо 127.0.0.1 
        * sudo systemctl restart snmpd
    * В качестве аргумента скрипт должен принимать доменное имя устройства
        * Учетно в скрипте 
    * По умолчанию скрипт должен выводить информацию на экран, но при использовании ключа `--dump` перед именем устройства, вывод должен быть сохранен в файл **имяустройства_текущаядатаивремя_report.txt**
        * Учтино в скрипте, после вставки необходимо внимательно проверить наличие символов _ ;

#### Сборка пакетов и публикация на сервере репозиториев

1. Выполните сборку бинарного приложения. 
    * Приложение необходимо упаковать в deb пакет. 
    * Deb пакет должен называться `reaskills-today` и выполнятся при помощи одноименной команды. 
    * Приложение должно устанавливаться в директорию **/usr/bin/**.  
    * В control файле обязательно укажите следующие атрибуты:
        * Package – reaskills-today
        * Version – 1.0-2026
        * Maintainer – Ваше имя и произвольный email
        * Architecture – amd64
        * Section – misc
        * Description – Придумайте что-то смешное
        * Priority – optional
    * решение:
        * apt install -y build-essential libncurses5-dev
        * wget 10.150.0.200/extra/reaskills-today.c
        * gcc -O2 -o reaskills-today reaskills-today.c -lncurses (если не сработало, то gcc -O2 -o reaskills-today reaskills-today.c -lncursesw)
        * mkdir -p reaskills-today_1.0-2026_amd64/DEBIAN reaskills-today_1.0-2026_amd64/usr/bin
        * cp ./reaskills-today reaskills-today_1.0-2026_amd64/usr/bin/reaskills-today
        * chmod 0755 reaskills-today_1.0-2026_amd64/usr/bin/reaskills-today
        * nano reaskills-today_1.0-2026_amd64/DEBIAN/control
        ```
            Package: reaskills-today
            Version: 1.0-2026
            Section: misc
            Priority: optional
            Architecture: amd64
            Maintainer: Ваше Имя <you@example.com>
            Description: Этот пакет показывает сегодняшний день и напоминает, что завтра дедлайн.
        ```
        * dpkg-deb --build reaskills-today_1.0-2026_amd64
        * dpkg -i reaskills-today_1.0-2026_amd64.deb
        * which reaskills-today
        * reaskills-today
 
2. Подготовленный пакет опубликуйте в репозиторий на **ISP-SRV**.
    * Подготовьте репозиторий.
    * Репозиторий должен подключатся по записи `deb https://repo.rea26.skills reaskills reaskills-apps`. 
    * При обновлении списка актуальных пакетов не должно возникать предупреждений безопасности. Использование дополнительный параметров конфигурации файла `sources.list` не допускается. 
    * Подключите репозиторий и установите пакет на **CR-CLI**. На **BR-CLI** подключите репозиторий, но пакет не устанавливайте. 
    * Репозиторий должен быть сконфигурирован в файле `/etc/apt/sources.list.d/rea2026.list`.
    * решение:
        * apt-get install -y reprepro gnu
        * mkdir -p /srv/aptrepo/{conf,incoming} && chown -R $USER:$USER /srv/aptrepo
        * 
        ```
            gpg --batch --gen-key <<'EOF'
            Key-Type: RSA
            Key-Length: 4096
            Name-Real: REA26 Repo
            Name-Email: repo@rea26.skills
            Expire-Date: 0
            %no-protection
            %commit
            EOF
        ```
        * gpg --list-keys --with-colons repo@rea26.skills | awk -F: '/^pub/ {print $5; exit}'
        * KEYID="<ВАШ_KEYID>"
        * 
        ```
            cat > /srv/aptrepo/conf/distributions <<EOF
            Origin: rea26
            Label: rea26
            Suite: reaskills
            Codename: reaskills
            Components: reaskills-apps
            Architectures: amd64
            SignWith: ${KEYID}
            EOF
        ```
        * reprepro -b /srv/aptrepo includedeb reaskills ./reaskills-today_1.0-2026_amd64.deb
        * обновите nginx так (не забудьте серты)
        ```
            server {
                listen 443 ssl;
                server_name repo.rea26.skills;

                ssl_certificate     /etc/ssl/certs/repo.rea26.skills.crt;
                ssl_certificate_key /etc/ssl/private/repo.rea26.skills.key;

                root /srv/aptrepo;

                location / {
                    autoindex on;
                }
            }
        ```
        * gpg --export -a repo@rea26.skills > /tmp/rea26-repo.asc
        * Скопировать /tmp/rea26-repo.asc на cr-crl и br-cli
        * на клиентах: sudo gpg --dearmor -o /etc/apt/trusted.gpg.d/rea26-repo.gpg rea26-repo.asc
        * sudo chmod 0644 /etc/apt/trusted.gpg.d/rea26-repo.gpg
        * на клиентах: echo "deb https://repo.rea26.skills reaskills reaskills-apps" | sudo tee /etc/apt/sources.list.d/rea2026.list
        * 
        ```
            sudo tee /etc/apt/apt.conf.d/99rea26-direct >/dev/null <<'EOF'
            Acquire::http::Proxy::repo.rea26.skills "DIRECT";
            Acquire::https::Proxy::repo.rea26.skills "DIRECT";
            EOF
        ```
        * sudo apt-get update && apt-get install -y reaskills-today (скаичваем только на cr-cli)
#### Настройка сервисов провайдера

1. На сервере ISP-SRV разверните DNS сервер с использованием пакета **bind**. 
    * Обеспечьте делегацию поддомена **rea26.skills** на **CR-DC**. 
    * Сервер должен управлять зоной **rea26.ru**.

2. Сконфигурируйте веб-сайт провайдера.
    * При доступе по имени **isp.rea26.skills** сайт должен отдавать содержимое `<h1>Hello from office</h1>`, а при доступе по **isp.rea26.ru** -- `<h1>Hello from Internet</h1>`. 
        * mkdir -p /var/www/isp.skills /var/www/isp.ru /var/www/error /var/www/isp.skills/secret
        * echo "`<h1>Hello from office</h1>`" | tee /var/www/isp.skills/index.html && echo "`<h1>Hello from Internet</h1>`" |  tee /var/www/isp.ru/index.html && echo "`<h1>Very secret place</h1>`" | tee /var/www/isp.skills/secret/index.html
        * cd /var/www/error && wget http://10.150.0.200/extra/404.html
        * apt install nginx 
        * htpasswd -cb /etc/nginx/.htpasswd mikhalych dr0wss@P
        * Настроить конфиг в /etc/nginx/site-available/isp.conf, как в git/common/isp-nginx.conf
        * ln -s /etc/nginx/site-available/isp.conf /etc/nginx/site-enabled/isp.conf && rm -rf /etc/nginx/site-enabled/default
        * systemctl restart nginx (при перезагрузке может быть ошибка с сертами, их надо полодить, куда надо)
    * При попытке подключения по IP адресу пользователь должен получать ошибку 404 и видеть кастомную страницу. Страницу можно найти на files (**404.html**).
        * учетно
    * Обеспечьте работу с использованием защищенной реализации протокола передачи гипертекста и перенаправления в случае использования его незащищенной реализации. 
        * учетно
    * Эндпоинт **/secret** необходимо защитить при помощи базовой аутентификации. В качестве логина для входа используйте **mikhalych** с паролем **dr0wss@P**
        * учетно


-----


## Модуль C: «Пуско-наладка сетевой инфраструктуры»

#### Базовая настройка устройств MPLS-GW-\*

1. Выполните подготовку устройств.
    * Настройте имена устройств по шаблону **\<hostname\>.rea26.ru**.
        * (config) hostname mpls-gw-cr.rea26.ru
    * На все устройства добавьте административную учетную запись **adminer** с паролем **P@ssw0rd**.
        * (config) username adminer
        * (config-user) role admin
        * (config-user) password P@ssw0rd
    * Защитите доступ к привилегированному режиму при помощи пароля **P@ssw0rd**.
        * (config) enable password P@ssw0rd
    * Деактивируйте встроенную учетную запись администратора.
        * (config) username adsmin
        * (config-user) deactivate
    * Обеспечьте хранение всех паролей в защищенном виде.
        * (config) service password-encryption
    * Для доступа в Интернет настройте получение адреса по DHCP на **MPLS-GW-CORE**. (хз на скольковерно сделано, не вижу смысла в задании)
        *  (config) dhcp-profile 0
        *  (config-dhcp) server 192.168.122.1
        *  (config-dhcp) mode relay
        *  (config-dhcp) information-option circuit-id Router: %{PORT}/ client: %{CMAC}/%{SVLAN}.%{CVLAN}
        *  (config-dhcp) information-option remote-id Router: %{HNAME}/%{VR}
        *  (config) interface ge2
        *  (config-if) dhcp-profile 0
2. Обеспечьте возможность административного доступа по SSH.
	* С клиентского хоста (с постфиксом **CLI**) в каждом офисе к соответствующему офисному маршрутизатору.
        *  (config) security-profile 1 - создание нового набора правил безопасности (firewall) по дефолту все разрешено
        *  (config-security-profile) rule 0 permit tcp <подсеть клеинта a.b.c.d/mask> any eq 22 - разрешаем из сети клиента только в офисе 
        *  (config-security-profile) rule 1 deny tcp any any eq 22 - запрещаем из других мест
        *  (config) security 1 - включение 
        *  С клиента ssh adminer@<ip маршрутизатора в офисе> (ip будет таким же, как gw для клиента)
	* С любых клиентских хостов (с постфиксом **CLI**) до маршрутизатора **MPLS-GW-CORE**.
        * По идее под дефолту работает 
	* Доступ по SSH извне к маршрутизаторам в офисах должен быть запрещен.
        * Сделали первым правилом из первого пункта
3. На **MPLS-GW-CORE** установите приветствие "! REASKILLS 2026 !" при входе в консоль tty.
    * (config) banner motd ! REASKILLS 2026 !

4. Полезное по разделу :
    * \# show users localdb - пользаков посмотреть на роутере
    * Как посмотерть пароли для пользователей? 
    * \# show running-config
    * \# write
    * dhcpcd -U enp1s0 | grep dhcp_server - поиск ip dhcp-сервера откуда пришел адресс на debian.
    dhcp сервер находится на 192.168.122.1 (ISP-SRV и out-cli берут с него адрес)
    * \# show dhcp-profile
    * https://clck.ru/3RKP6z - настройка dhcp дока
    * \# show ip interface brief  - метчинг интерфейсов и ip 
    * #show security-profile - посмотреть профили безопасности
    * Чтобы получить доступ из out в офисы надо добавить на out маршрут до сетей, потому что предназначенный gw на out не знает ничего про них
    * Для првоерки работы ssh и пингов можно настроить ospf быстро, но его придется праивть дальше. На каждом роутере делаем:
        * (config) router ospf 1
        * (config-router) network <a.b.c.d/24> 0.0.0.255 area 0    Эту команду надо выполнить столько раз, сколько сетей окружает роутер (на каждом по 3 получится, <a.b.c.d/24> - это адерес сети)

#### Настройка коммутации и маршрутизации

1. Обеспечьте передачу маршрутной информации между маршрутизаторами с использованием открытого протокола поиска наиболее короткого пути.
    * В качестве RouterID используйте loopback интерфейсы на маршрутизаторах.
        * (config) interface loopback0
        * (config-if) ip address 10.255.10.1/24 (любой ip для маршрутизаторов, из одной сети, для каждого роутера свой ip)
        * (config) router ospf 1
        * (config-router) router-id 10.255.10.1 (Для каждого роутера свой ip)
        * \# clear ip ospf process 
        * Если вы в прошлом пункте не прописали network команды, то самое время это сделать
            * (config) router ospf 1
            * (config-router) network <a.b.c.d> 0.0.0.255 area 0    Эту команду надо выполнить столько раз, сколько сетей окружает роутер (на каждом по 3 получится, <a.b.c.d> - это адерес сети) и для каждого роутера
        * По идее теперь все должно пинговаться(если настроили ip и gw на всех устройствах)
    * Обеспечьте распространение маршрута по умолчанию.
        * (config) ip route 0.0.0.0 0.0.0.0 ge2 на core
        * (config) router ospf 1
        * (config-router) default-information originate - чтобы core ананосировал этот дефолт остальным
    * Отключите рассылку сообщений протокола маршрутизации, на интерфейсах, которые не участвуют в маршрутизации.
        * На интерфесах к конечным устойтсвам выполняем (config-if) ip ospf database-filter all out (core не трогаем вообще, **но тут надо уточнить думаю**)
    * Обеспечьте доступ в Интернет для всех серверов и клиентов топологии.
        * чтобы можно было из out обращаться в офисы пишем статические маршруты на isp и out-cli
        ```
            iface enp1s0 inet dhcp
                up ip route add 192.168.1.0/24 via 192.168.122.2
                up ip route add 192.168.2.0/24 via 192.168.122.2
                up ip route add 192.168.3.0/24 via 192.168.122.2
                up ip route add 192.168.4.0/24 via 192.168.122.2
                up ip route add 192.168.5.0/24 via 192.168.122.2
                up ip route add 192.168.6.0/24 via 192.168.122.2
        ```
        * чтобы можно было общаться с интернетом из офисов надо натсроить nat на core
            * (config) ip nat pool POOL 192.168.1.0-192.168.6.255
            * (config) ip nat source dynamic inside-to-outside pool POOL overload interface ge2
2. Обеспечьте связанность между офисами с использованием технологии коммутации на основании меток.
    * Для распространения информации о метках используйте протокол LDP.
    * В качестве PE маршрутизаторов используйте **MPLS-GW-BR** и **MPLS-GW-CR**.
    * В качестве P маршрутизатора используйте **MPLS-GW-CORE**.
    * Обеспечьте прозрачную L2 связанность обоих офисов. Оба офиса должны находиться в одном широковещательном домене.

#### Резервное копирование конфигурации, IP SLA и мониторинг

1. Обеспечьте выгрузку резервной копии конфигурации каждого маршрутизатора на TFTP-сервер, который вы развернули ранее (https://docs.ecorouter.ru/Руководство/07-Экспорт-и-импорт-конфигурации/#экспорт-конфигурации).
2. Сконфигурируйте IP SLA на PE маршрутизаторах для проверки доступности **ISP-SRV** по ICMP (https://docs.ecorouter.ru/Руководство/13-IP-SLA/).
    * Назовите SLA профиль **reaskills**.
        * (config) ip sla-profile reaskills
        * (config-sla) icmp 192.168.122.103
        * (config-sla) enable
    * SLA должен срабатывать при четырех потерянных пакетах.
        * (config-sla) monitor packet-loss 4
    * Интервал отправки сообщений должен быть равен половине минуты.
        * (config-sla) packet-frequency 30
   * Полезное:
        * \# show ip sla-profile reaskills
        * \# show ip sla-profile summary
3. Обеспечьте доступ по протоколу SNMPv3 на каждый маршрутизатор с сервера **CR-SRV** (https://docs.ecorouter.ru/Руководство/16-SNMP/06-SNMPv3) - ничего дельного нет.
    * В качестве имени группы используйте **reaskills**.
        * (config) snmp-server view reaskills .1 included
        * (config) snmp-server group reaskills v3 priv read reaskills write reaskills
    * В качестве имени пользователя и пароля используйте **snmpuser** и **snmppass** соответственно.
        * (config) snmp-server user snmpuser group reaskills auth md5 snmppass priv aes snmppass
        * (config) snmp-server enable snmp
    * Обеспечьте наличие утилиты `snmpwalk` на **CR-SRV**.
        * Уже есть или apt install snmp
    * Полезное:
        * чтоб-то можно глянуть в \# show snmp *
        * ВАЖНО!!!! Чтобы security был 1 (профиль, который создали ранее, где все разрешено, потому что default блокает нужный порт)

-----

## Модуль D: «Пуско-наладка инфраструктуры разработки»

1. На серверах **BR-SRV1**, **BR-SRV2**, **BR-SRV3** разверните кластер micro-k8s.
    * Для организации доступа клиентов в кластер разверните MetalLB. 
    * В качестве ingress контроллера используйте nginx. 
2. Разверните Registry для хранения образов в microk8s. 
    * Обеспечьте доступ к registry через ingress контроллер с использованием сертификатов, выпущенных корпоративным CA. 
    * В качестве имени используйте **registry.rea26.skills**. 
    * Загрузите в registry все нужные вам docker образа. Используйте его при развертывании приложений в k8s.
3. Разверните корпоративный веб сайт. 
    * Сайт должен быть доступен по имени **portal.rea26.skills** из внутренней сети и **portal.rea26.ru** из внешней сети. 
    * Выполните все необходимые настройки на сетевом оборудовании и сервере провайдера для организации доступа к порталу.
    * В качестве приложения для портала используйте `portal.py`. 
    * Доступ к приложению должен быть защищен сертификатами.
    * Должно быть запущенно два экземпляра сервиса в кластере.
4. Разверните kube-state-metrics, prometheus, grafana для мониторинга кластера. 
    * Prometheus используйте в качестве источника данных в Grafana.
    * Веб-интерфейс Grafana должен быть доступен по имени grafana.rea26.skills. Пользователю **admin** установите пароль **gingerbread**
    * Импортируйте дашборд `kube_state_metrics.json` и убедитесь, что он не пуст. Получить его можно на files.


## Приложение 1. Топология

![Топология](/diag.png)

## Приложение 2. Перечень используемых ОС

| Операционная система | Узлы |
|----------------------------|-------|
| EcoRouter OS 7 (маршрутизатор EcoRouter) | MPLS-GW-CORE, MPLS-GW-BR, MPLS-GW-CR |
| Astra Linux 1.7.7 CLI | BR-DC, CR-DC, CR-SRV | 
| Astra Linux 1.8.1 CLI | BR-SRV1, BR-SRV2, BR-SRV3 |
| Astra Linux 1.8.1 GUI | BR-CLI, CR-CLI, OUT-CLI |
| Debian 13 | ISP-SRV |
| Windows Server 2025 | WIN-AD |

## Приложение 3. Список полностью определённых доменных имён

| Полностью определённое доменное имя   | Описание                       |
| ------------------------------------- | ------------------------------ |
| <имя-узла>.rea26.skills               | Серверные узлы и клиенты       |
| <имя-узла>.rea26.ru                   | Маршрутизаторы MPLS-GW-*       |
| ald.rea26.skills                      | Веб-интерфейс ALD Pro          |
| repo.rea26.skills                     | Репозиторий                    |
| isp.rea26.skills и isp.rea26.ru       | Сайт провайдера                |
| registry.rea26.skills                 | Хранилище образов для Microk8s |
| portal.rea26.skills и portal.rea26.ru | Корпоративный веб-сайт         |
| grafana.rea26.skills                  | Портал Grafana                 |